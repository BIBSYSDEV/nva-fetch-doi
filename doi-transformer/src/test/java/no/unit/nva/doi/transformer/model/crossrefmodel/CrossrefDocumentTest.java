package no.unit.nva.doi.transformer.model.crossrefmodel;

import static no.unit.nva.hamcrest.DoesNotHaveNullOrEmptyFields.doesNotHaveNullOrEmptyFields;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.core.Is.is;
import static org.hamcrest.core.IsEqual.equalTo;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonNode;
import java.io.IOException;
import java.nio.file.Path;
import no.sikt.nva.doi.fetch.jsonconfig.Json;
import no.unit.nva.commons.json.JsonUtils;
import nva.commons.core.ioutils.IoUtils;
import org.junit.jupiter.api.Test;

public class CrossrefDocumentTest {

    private static final Path CROSSREF_RESOURCE = Path.of("crossref.json");
    private static final Path CROSSREF_BOOK_RESOURCE = Path.of("crossref_sample_book.json");
    private static final Path CROSSREF_BOOK_CHAPTER_RESOURCE = Path.of("crossref_sample_book_chapter.json");
    private static final Path CROSSREF_EDITED_BOOK_RESOURCE = Path.of("crossref_sample_edited_book.json");

    @Test
    public void testSettersAndGetters() throws IOException {

        String resourceString = IoUtils.stringFromResources(CROSSREF_RESOURCE);
        CrossrefApiResponse crossRefResponse = Json
            .readValue(resourceString, CrossrefApiResponse.class);
        String serializedObject = Json.writeValueAsString(crossRefResponse);
        CrossrefApiResponse deserializedObject = Json
            .readValue(serializedObject, CrossrefApiResponse.class);

        assertThat(Json.convertValue(deserializedObject, JsonNode.class),
                   is(equalTo(Json.convertValue(crossRefResponse, JsonNode.class))));
    }

    @Test
    public void testSettersAndGettersCrossrefBook() throws IOException {

        String resourceString = IoUtils.stringFromResources(CROSSREF_BOOK_RESOURCE);
        CrossrefApiResponse crossRefResponse = Json
            .readValue(resourceString, CrossrefApiResponse.class);
        String serializedObject = Json.writeValueAsString(crossRefResponse);
        CrossrefApiResponse deserializedObject = Json
            .readValue(serializedObject, CrossrefApiResponse.class);

        assertThat(crossRefResponse, doesNotHaveNullOrEmptyFields());
        assertThat(Json.convertValue(deserializedObject, JsonNode.class),
                   is(equalTo(Json.convertValue(crossRefResponse, JsonNode.class))));
    }

    @Test
    public void testSettersAndGettersCrossrefBookChapter() throws IOException {

        String resourceString = IoUtils.stringFromResources(CROSSREF_BOOK_CHAPTER_RESOURCE);
        CrossrefApiResponse crossRefResponse = Json
            .readValue(resourceString, CrossrefApiResponse.class);
        String serializedObject = Json.writeValueAsString(crossRefResponse);
        CrossrefApiResponse deserializedObject = Json
            .readValue(serializedObject, CrossrefApiResponse.class);

        assertThat(crossRefResponse, doesNotHaveNullOrEmptyFields());
        assertThat(Json.convertValue(deserializedObject, JsonNode.class),
                   is(equalTo(Json.convertValue(crossRefResponse, JsonNode.class))));

    }

    @Test
    public void testSettersAndGettersCrossrefEditedBook() throws IOException {

        String resourceString = IoUtils.stringFromResources(CROSSREF_EDITED_BOOK_RESOURCE);
        CrossrefApiResponse crossRefResponse = Json
            .readValue(resourceString, CrossrefApiResponse.class);
        String serializedObject = Json.writeValueAsString(crossRefResponse);
        CrossrefApiResponse deserializedObject = Json
            .readValue(serializedObject, CrossrefApiResponse.class);

        assertThat(crossRefResponse, doesNotHaveNullOrEmptyFields());
        assertThat(Json.convertValue(deserializedObject, JsonNode.class),
                   is(equalTo(Json.convertValue(crossRefResponse, JsonNode.class))));

    }

    @Test
    void shouldDo() throws JsonProcessingException {
        var string = """
            {"status":"ok","message-type":"work","message-version":"1.0.0","message":{"institution":[{"name":"bioRxiv"}],"indexed":{"date-parts":[[2025,8,2]],"date-time":"2025-08-02T14:46:04Z","timestamp":1754145964519,"version":"3.41.2"},"posted":{"date-parts":[[2025,6,14]]},"group-title":"Ecology","reference-count":67,"publisher":"Cold Spring Harbor Laboratory","license":[{"start":{"date-parts":[[2025,6,14]],"date-time":"2025-06-14T00:00:00Z","timestamp":1749859200000},"content-version":"vor","delay-in-days":0,"URL":"http:\\/\\/creativecommons.org\\/licenses\\/by-nc-nd\\/4.0\\/"}],"funder":[{"name":"The Research Council of Norway","award":["301922"]}],"content-domain":{"domain":[],"crossmark-restriction":false},"short-container-title":[],"accepted":{"date-parts":[[2025,6,14]]},"abstract":"<jats:title>Abstract<\\/jats:title>\\n<jats:p>The age-class distribution of forests is a key indicator of both carbon stock potential and biodiversity conservation, playing a vital role in sustainable forest management. In Norway, birch (<jats:italic>Betula<\\/jats:italic>spp.) is the most abundant tree species, covering 42% of the forest area. Understanding the factors that shape the age structure of birch is essential for developing management practices that balance timber production, carbon sequestration, and biodiversity conservation. Using data from the Norwegian National Forest Inventory (NFI), we examined the age-class distribution of birch trees across various site conditions. Our analysis revealed that middle-aged trees (50\\u2013100 years) were prevalent in most regions, while older trees were notably scarce, particularly in highly productive areas. This pattern reflects management strategies prioritizing younger, fast-growing trees to maximize economic returns. In contrast, less productive sites, which are often managed less intensively, tend to support older trees. Additionally, younger birch trees revealed significantly greater radial growth than older generations when evaluated at the same biological age (e.g., at 10 years old), particularly under favorable site conditions. These findings underscore the combined effects of site productivity, forest management, and environmental factors on growth dynamics and age-class distribution.<\\/jats:p>","DOI":"10.1101\\/2025.06.10.658859","type":"posted-content","created":{"date-parts":[[2025,6,15]],"date-time":"2025-06-15T04:10:17Z","timestamp":1749960617000},"source":"Crossref","is-referenced-by-count":0,"title":["Factors influencing birch ( <i>Betula spp.<\\/i> ) age distribution in Norway: Insights from tree ring data"],"prefix":"10.1101","author":[{"ORCID":"https:\\/\\/orcid.org\\/0000-0002-8631-2982","authenticated-orcid":false,"given":"M","family":"Vergarechea","sequence":"first","affiliation":[]},{"ORCID":"https:\\/\\/orcid.org\\/0000-0001-5545-3320","authenticated-orcid":false,"given":"C","family":"Ant\\u00f3n-Fern\\u00e1ndez","sequence":"additional","affiliation":[]},{"ORCID":"https:\\/\\/orcid.org\\/0000-0003-1517-1569","authenticated-orcid":false,"given":"J.U","family":"Jepsen","sequence":"additional","affiliation":[]},{"ORCID":"https:\\/\\/orcid.org\\/0000-0003-2483-2568","authenticated-orcid":false,"given":"O. P.L","family":"Vindstad","sequence":"additional","affiliation":[]},{"given":"R","family":"Astrup","sequence":"additional","affiliation":[]}],"member":"246","reference":[{"key":"2025061702400834000_2025.06.10.658859v1.1","first-page":"103","article-title":"Forest limits and the subalpine birch belt in North Europe with a focus on Norway","volume":"37","year":"2000","journal-title":"AmSVaria"},{"key":"2025061702400834000_2025.06.10.658859v1.2","doi-asserted-by":"crossref","unstructured":"Altman, J . 2020. Tree-ring-based disturbance reconstruction in interdisciplinary research: Current state and future directions. Dendrochronologia 63.","DOI":"10.1016\\/j.dendro.2020.125733"},{"key":"2025061702400834000_2025.06.10.658859v1.3","doi-asserted-by":"publisher","DOI":"10.1139\\/X10-086"},{"key":"2025061702400834000_2025.06.10.658859v1.4","doi-asserted-by":"publisher","DOI":"10.1890\\/04-0488"},{"key":"2025061702400834000_2025.06.10.658859v1.5","doi-asserted-by":"publisher","DOI":"10.1111\\/j.1365-2699.2008.01941.x"},{"key":"2025061702400834000_2025.06.10.658859v1.6","doi-asserted-by":"publisher","DOI":"10.1127\\/phyto\\/2017\\/0111"},{"key":"2025061702400834000_2025.06.10.658859v1.7","first-page":"123","article-title":"Norges skoger med stormskridt mot undergangen","volume":"24","year":"1916","journal-title":"Tidsskr Skogbr"},{"key":"2025061702400834000_2025.06.10.658859v1.8","doi-asserted-by":"publisher","DOI":"10.1016\\/j.dendro.2016.03.011"},{"key":"2025061702400834000_2025.06.10.658859v1.9","doi-asserted-by":"publisher","DOI":"10.1016\\/j.envsci.2008.08.005"},{"key":"2025061702400834000_2025.06.10.658859v1.10","doi-asserted-by":"publisher","DOI":"10.1016\\/j.tplants.2012.08.005"},{"key":"2025061702400834000_2025.06.10.658859v1.11","doi-asserted-by":"crossref","unstructured":"Breidenbach, J. , A. Granhus , G. Hylen , R. Eriksen , and R. Astrup . 2020. A century of National Forest Inventory in Norway \\u2013 informing past, present, and future decisions. Forest Ecosystems 7.","DOI":"10.1186\\/s40663-020-00261-0"},{"key":"2025061702400834000_2025.06.10.658859v1.12","doi-asserted-by":"publisher","DOI":"10.1080\\/02827581.2012.689005"},{"key":"2025061702400834000_2025.06.10.658859v1.13","doi-asserted-by":"publisher","DOI":"10.1139\\/cjfr-2018-0098"},{"key":"2025061702400834000_2025.06.10.658859v1.14","doi-asserted-by":"publisher","DOI":"10.1016\\/j.dendro.2012.01.002"},{"key":"2025061702400834000_2025.06.10.658859v1.15","doi-asserted-by":"publisher","DOI":"10.1093\\/forestry\\/69.4.357"},{"key":"2025061702400834000_2025.06.10.658859v1.16","doi-asserted-by":"publisher","DOI":"10.1016\\/j.foreco.2009.11.011"},{"key":"2025061702400834000_2025.06.10.658859v1.17","doi-asserted-by":"publisher","DOI":"10.1111\\/j.1365-2486.2011.02617.x"},{"key":"2025061702400834000_2025.06.10.658859v1.18","doi-asserted-by":"crossref","unstructured":"Di Filippo, A. , N. Pederson , M. Baliva , M. Brunetti , A. Dinella , K. Kitamura , H. D. Knapp , B. Schirone , and G. Piovesan . 2015. The longevity of broadleaf deciduous trees in Northern Hemisphere temperate forests: insights from tree-ring series. Frontiers in Ecology and Evolution 3.","DOI":"10.3389\\/fevo.2015.00046"},{"key":"2025061702400834000_2025.06.10.658859v1.19","first-page":"310","article-title":"Consequences of various landscape-scale ecosystem management strategies and fire cycles on age-class structure and harvest in boreal forests 1. J","volume":"34","year":"2004","journal-title":"For. Res"},{"key":"2025061702400834000_2025.06.10.658859v1.20","doi-asserted-by":"crossref","unstructured":"Fridman, J. , S. Holm , M. Nilsson , P. Nilsson , A. H. Ringvall , and G. St\\u00e5hl . 2014. Adapting National Forest Inventories to changing requirements \\u2013 the case of the Swedish National Forest Inventory at the turn of the 20th century.","DOI":"10.14214\\/sf.1095"},{"key":"2025061702400834000_2025.06.10.658859v1.21","doi-asserted-by":"crossref","unstructured":"Gold, S. , A. Korotkov , and V. Sasse . 2006. The development of European forest resources, 1950 to 2000. Forest Policy and Economics 8:183-192.","DOI":"10.1016\\/j.forpol.2004.07.002"},{"key":"2025061702400834000_2025.06.10.658859v1.22","doi-asserted-by":"publisher","DOI":"10.1016\\/j.dendro.2018.10.009"},{"key":"2025061702400834000_2025.06.10.658859v1.23","doi-asserted-by":"publisher","DOI":"10.1007\\/s11629-020-6221-1"},{"key":"2025061702400834000_2025.06.10.658859v1.24","first-page":"3","article-title":"Growth response of Betula pubescens Ehrh. to varying disturbance factors in northern Norway","volume":"1","year":"2021","journal-title":"Trees"},{"key":"2025061702400834000_2025.06.10.658859v1.25","doi-asserted-by":"publisher","DOI":"10.1016\\/j.ancene.2019.100212"},{"key":"2025061702400834000_2025.06.10.658859v1.26","first-page":"67","article-title":"What determines the timberline?","volume":"180","year":"2002","journal-title":"Fennia - International Journal of Geography"},{"key":"2025061702400834000_2025.06.10.658859v1.27","doi-asserted-by":"publisher","DOI":"10.2307\\/3236125"},{"key":"2025061702400834000_2025.06.10.658859v1.28","unstructured":"Holmstr\\u00f6m, E . 2015. Regeneration and early management of birch and Norway spruce mixtures in Southern Sweden. Swedish University of Agricultural Sciences."},{"key":"2025061702400834000_2025.06.10.658859v1.29","doi-asserted-by":"publisher","DOI":"10.1111\\/j.1466-822X.2005.00168.x"},{"key":"2025061702400834000_2025.06.10.658859v1.30","first-page":"103","article-title":"Silviculture of birch (Betula pendula Roth and Betula pubescens Ehrh","volume":"83","year":"2009","journal-title":"in northern Europe. Forestry: An International Journal of Forest Research"},{"key":"2025061702400834000_2025.06.10.658859v1.31","doi-asserted-by":"publisher","DOI":"10.1007\\/s10021-012-9629-9"},{"key":"2025061702400834000_2025.06.10.658859v1.32","doi-asserted-by":"publisher","DOI":"10.1111\\/J.1365-2656.2007.01339.X"},{"key":"2025061702400834000_2025.06.10.658859v1.33","doi-asserted-by":"publisher","DOI":"10.1111\\/j.0906-7590.2004.03869.x"},{"key":"2025061702400834000_2025.06.10.658859v1.34","first-page":"169","article-title":"Tree age distributions in old-growth forest sites in Vienansalo wilderness, eastern Fennoscandia","volume":"36","year":"2002","journal-title":"Silva Fennica"},{"key":"2025061702400834000_2025.06.10.658859v1.35","unstructured":"Landsskogtakseringen. 1920. Taksering av Norges skoger utf\\u00f8rt av Landsskogtakseringen - 1. \\u00d8stfold fylke, Hamar."},{"key":"2025061702400834000_2025.06.10.658859v1.36","unstructured":"Landsskogtakseringen. 1933. Taksering av Norges skoger utf\\u00f8rt av Landsskogtakseringen, Oslo."},{"key":"2025061702400834000_2025.06.10.658859v1.37","unstructured":"Landsskogtakseringen. 1938. Taksering av Norges skoger utf\\u00f8rt av Landsskogtakseringen. \\u00d8stfold fylke. Revisjonstaksering 1937, Oslo."},{"key":"2025061702400834000_2025.06.10.658859v1.38","unstructured":"Landsskogtakseringen. 1959. Taksering av Norges skoger utf\\u00f8rt av Landsskogtakseringen. \\u00d8stfold og Akershus fylke. Revisjonstaksering 1957, Oslo."},{"key":"2025061702400834000_2025.06.10.658859v1.39","unstructured":"Landsskogtakseringen. 1968. The National Forest Survey of Norway - instructions for field work. Oslo. Landsskogtakseringen. 1970. Taksering av Norges skoger. Landsskogtakseringen 50 \\u00e5r. 1919\\u20131969."},{"key":"2025061702400834000_2025.06.10.658859v1.40","first-page":"135","article-title":"Climatic effects on birch (Betula pubescens Ehrh","volume":"25","year":"2008","journal-title":"growth in Fnjoskadalur valley, northern Iceland. Dendrochronologia"},{"key":"2025061702400834000_2025.06.10.658859v1.41","doi-asserted-by":"publisher","DOI":"10.1007\\/s11056-023-09971-z"},{"key":"2025061702400834000_2025.06.10.658859v1.42","doi-asserted-by":"publisher","DOI":"10.1016\\/j.foreco.2007.03.007"},{"key":"2025061702400834000_2025.06.10.658859v1.43","unstructured":"Moen, A . 1998. National atlas of Norway. Vegetation. Norwegian Mapping Authority, H\\u00f8nefoss."},{"key":"2025061702400834000_2025.06.10.658859v1.44","doi-asserted-by":"crossref","first-page":"155","DOI":"10.1002\\/pei3.10087","article-title":"Long-term spatiotemporal dynamics in a mountain birch (Betula pubescens ssp. czerepanovii) forest in south-east Norway","volume":"3","year":"2022","journal-title":"Plant-Environment Interactions"},{"key":"2025061702400834000_2025.06.10.658859v1.45","doi-asserted-by":"publisher","DOI":"10.1038\\/ncomms5750"},{"key":"2025061702400834000_2025.06.10.658859v1.46","doi-asserted-by":"publisher","DOI":"10.3832\\/ifor3412-013"},{"key":"2025061702400834000_2025.06.10.658859v1.47","doi-asserted-by":"crossref","unstructured":"Rytter, L. , M. Ingerslev , A. Kilpel\\u00e4inen , P. Torssonen , D. Lazdina , M. L\\u00f6f , P. Madsen , P. Muiste , and L.-G. Stener . 2016a. Increased forest biomass production in the Nordic and Baltic countries \\u2013 a review on current and future opportunities.","DOI":"10.14214\\/sf.1660"},{"key":"2025061702400834000_2025.06.10.658859v1.48","doi-asserted-by":"crossref","unstructured":"Rytter, L. , M. Ingerslev , A. Kilpel\\u00e4inen , P. Torssonen , D. Lazdina , M. L\\u00f6f , P. Madsen , P. Muiste , and L. G. Stener . 2016b. Increased forest biomass production in the Nordic and Baltic countries - A review on current and future opportunities. Silva Fennica 50.","DOI":"10.14214\\/sf.1660"},{"key":"2025061702400834000_2025.06.10.658859v1.49","doi-asserted-by":"publisher","DOI":"10.1016\\/j.dendro.2019.03.002"},{"key":"2025061702400834000_2025.06.10.658859v1.50","doi-asserted-by":"publisher","DOI":"10.1007\\/s11027-010-9243-0"},{"key":"2025061702400834000_2025.06.10.658859v1.51","doi-asserted-by":"publisher","DOI":"10.1088\\/1748-9326\\/aaea9e"},{"key":"2025061702400834000_2025.06.10.658859v1.52","unstructured":"Sj\\u00f8lie, H. K . 2011. Analyses of the use of the Norwegian forest sector in climate change mitigation."},{"key":"2025061702400834000_2025.06.10.658859v1.53","unstructured":"Skogsstatistisk. 1998. Statistical Yearbook of Forestry, National Board of Forestry, Sweden."},{"key":"2025061702400834000_2025.06.10.658859v1.54","doi-asserted-by":"publisher","DOI":"10.1080\\/02827581.2014.951389"},{"key":"2025061702400834000_2025.06.10.658859v1.55","unstructured":"Solberg, B. , H. T\\u00f8mmervik , D. Thannheiser , and S. Neuvonen . 2005. Economic limits and possibilities for sustainable utilization of northern birch forests. Pages 53-70 in Springer\\u2013Verlag, editor. Ecological Studies, Berlin."},{"key":"2025061702400834000_2025.06.10.658859v1.56","unstructured":"SSB. 2020. Research in Statistics Norway - SSB."},{"key":"2025061702400834000_2025.06.10.658859v1.57","doi-asserted-by":"publisher","DOI":"10.1111\\/j.1461-0248.2005.00746.x"},{"key":"2025061702400834000_2025.06.10.658859v1.58","doi-asserted-by":"crossref","unstructured":"Tenow, O. , Bylund, H. , Nilssen, A. and Karlsson, P . 2005. Long Term Influence of Herbivores on Northern Birch Forests. Plant Ecology, Herbivory, and Human Impact in Nordic Mountain Birch Forests:165\\u2013181.","DOI":"10.1007\\/3-540-26595-3_12"},{"key":"2025061702400834000_2025.06.10.658859v1.59","doi-asserted-by":"crossref","unstructured":"Tomppo, E. , T. Gschwantner , M. Lawrence , and R. E. McRoberts . 2010. National forest inventories: Pathways for common reporting. National Forest Inventories: Pathways for Common Reporting:1\\u2013612.","DOI":"10.1007\\/978-90-481-3233-1"},{"key":"2025061702400834000_2025.06.10.658859v1.60","doi-asserted-by":"publisher","DOI":"10.1080\\/02827581.2016.1141978"},{"key":"2025061702400834000_2025.06.10.658859v1.61","doi-asserted-by":"publisher","DOI":"10.1016\\/j.foreco.2011.02.027"},{"key":"2025061702400834000_2025.06.10.658859v1.62","doi-asserted-by":"publisher","DOI":"10.1016\\/j.foreco.2012.08.048"},{"key":"2025061702400834000_2025.06.10.658859v1.63","first-page":"201","article-title":"Forest age distribution and traces of past fires in a natural boreal landscape dominated by Picea abies","volume":"36","year":"2002","journal-title":"Silva Fennica"},{"key":"2025061702400834000_2025.06.10.658859v1.64","unstructured":"Wielgolaski, F. E. , S. R. Karlsen , and K. A. H\\u00f8gda . 2004. Plant phenology in Norway related to climate change and latitude. Proceedings of Challenging times."},{"key":"2025061702400834000_2025.06.10.658859v1.65","doi-asserted-by":"publisher","DOI":"10.1016\\/j.foreco.2009.07.041"},{"key":"2025061702400834000_2025.06.10.658859v1.66","doi-asserted-by":"publisher","DOI":"10.1007\\/s00468-011-0590-6"},{"key":"2025061702400834000_2025.06.10.658859v1.67","doi-asserted-by":"publisher","DOI":"10.1080\\/11263504.2011.650729"}],"container-title":[],"original-title":[],"link":[{"URL":"https:\\/\\/syndication.highwire.org\\/content\\/doi\\/10.1101\\/2025.06.10.658859","content-type":"unspecified","content-version":"vor","intended-application":"similarity-checking"}],"deposited":{"date-parts":[[2025,7,17]],"date-time":"2025-07-17T20:49:52Z","timestamp":1752785392000},"score":1,"resource":{"primary":{"URL":"http:\\/\\/biorxiv.org\\/lookup\\/doi\\/10.1101\\/2025.06.10.658859"}},"subtitle":[],"short-title":[],"issued":{"date-parts":[[2025,6,14]]},"references-count":67,"URL":"https:\\/\\/doi.org\\/10.1101\\/2025.06.10.658859","relation":{},"subject":[],"published":{"date-parts":[[2025,6,14]]},"subtype":"preprint"}}
            """;
        var response = JsonUtils.dtoObjectMapper.readValue(string, CrossrefApiResponse.class);
    }
}
